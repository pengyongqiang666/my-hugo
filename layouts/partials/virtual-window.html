{{/*
è™šæ‹Ÿçª—å£ç»„ä»¶ - Virtual Window Component
ä½¿ç”¨æ–¹æ³•: {{ partial "virtual-window.html" (dict "id" "my-window" "title" "çª—å£æ ‡é¢˜" "icon" "ğŸ¯" "url" "/test.html" "width" "80%" "height" "70%") }}

å‚æ•°è¯´æ˜:
- id: çª—å£å”¯ä¸€æ ‡è¯†ç¬¦ (å¿…éœ€)
- title: çª—å£æ ‡é¢˜ (é»˜è®¤: "è™šæ‹Ÿçª—å£")
- icon: çª—å£å›¾æ ‡ (é»˜è®¤: "ğŸªŸ")
- url: åµŒå…¥çš„é¡µé¢URL (å¿…éœ€)
- width: åˆå§‹å®½åº¦ (é»˜è®¤: "80%")
- height: åˆå§‹é«˜åº¦ (é»˜è®¤: "70%")
- minWidth: æœ€å°å®½åº¦ (é»˜è®¤: "400px")
- minHeight: æœ€å°é«˜åº¦ (é»˜è®¤: "300px")
- buttonText: æŒ‰é’®æ–‡å­— (é»˜è®¤: "æ‰“å¼€è™šæ‹Ÿçª—å£")
- buttonStyle: æŒ‰é’®æ ·å¼ç±» (é»˜è®¤: "virtual-window-btn-default")
- showBackdrop: æ˜¯å¦æ˜¾ç¤ºèƒŒæ™¯é®ç½© (é»˜è®¤: true)
*/}}

{{ $id := .id | default (printf "virtual-window-%d" now.Unix) }}
{{ $title := .title | default "è™šæ‹Ÿçª—å£" }}
{{ $icon := .icon | default "ğŸªŸ" }}
{{ $url := .url }}
{{ $width := .width | default "80%" }}
{{ $height := .height | default "70%" }}
{{ $minWidth := .minWidth | default "400px" }}
{{ $minHeight := .minHeight | default "300px" }}
{{ $buttonText := .buttonText | default "ğŸªŸ æ‰“å¼€è™šæ‹Ÿçª—å£" }}
{{ $buttonStyle := .buttonStyle | default "virtual-window-btn-default" }}
{{ $showBackdrop := .showBackdrop | default false }}

<!-- è™šæ‹Ÿçª—å£è§¦å‘æŒ‰é’® -->
<button class="virtual-window-trigger {{ $buttonStyle }}" 
        onclick="VirtualWindow.open('{{ $id }}')">
    {{ $buttonText | safeHTML }}
</button>

<!-- è™šæ‹Ÿçª—å£å®¹å™¨ -->
<div id="{{ $id }}" class="virtual-window" style="display: none;" 
     data-initial-width="{{ $width }}" 
     data-initial-height="{{ $height }}"
     data-min-width="{{ $minWidth }}"
     data-min-height="{{ $minHeight }}">
    
    <!-- çª—å£æ ‡é¢˜æ  -->
    <div class="virtual-window-titlebar">
        <div class="virtual-window-title">
            <span class="virtual-window-icon">{{ $icon | safeHTML }}</span>
            <span class="virtual-window-text">{{ $title | safeHTML }}</span>
        </div>
        <div class="virtual-window-controls">
            <button class="virtual-window-btn minimize-btn" 
                    onclick="VirtualWindow.minimize('{{ $id }}')" 
                    title="æœ€å°åŒ–">â–</button>
            <button class="virtual-window-btn fullscreen-btn" 
                    onclick="VirtualWindow.toggleFullscreen('{{ $id }}')" 
                    title="å…¨å±">â¬œ</button>
            <button class="virtual-window-btn close-btn" 
                    onclick="VirtualWindow.close('{{ $id }}')" 
                    title="å…³é—­">âœ•</button>
        </div>
    </div>

    <!-- æ‹–æ‹½è¦†ç›–å±‚ -->
    <div class="virtual-window-drag-overlay"></div>
    
    <!-- çª—å£å†…å®¹åŒºåŸŸ -->
    <div class="virtual-window-content">
        {{ if $url }}
            <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
            <div class="virtual-window-loader">
                <div class="virtual-window-spinner"></div>
                <div class="virtual-window-loader-text">å†…å®¹åŠ è½½ä¸­...</div>
            </div>
            <iframe class="virtual-window-iframe" 
                    data-src="{{ $url | safeURL }}" 
                    frameborder="0"
                    title="{{ $title }}">
            </iframe>
        {{ else }}
            <div class="virtual-window-error">
                <div class="error-icon">âš ï¸</div>
                <div class="error-title">é…ç½®é”™è¯¯</div>
                <div class="error-message">æœªæŒ‡å®šåµŒå…¥å†…å®¹URL</div>
            </div>
        {{ end }}
    </div>
    
    <!-- è°ƒæ•´å¤§å°æ‰‹æŸ„ -->
    <div class="virtual-window-resize-handles">
        <div class="virtual-window-resize-handle resize-n" data-direction="n"></div>
        <div class="virtual-window-resize-handle resize-s" data-direction="s"></div>
        <div class="virtual-window-resize-handle resize-e" data-direction="e"></div>
        <div class="virtual-window-resize-handle resize-w" data-direction="w"></div>
        <div class="virtual-window-resize-handle resize-ne" data-direction="ne"></div>
        <div class="virtual-window-resize-handle resize-nw" data-direction="nw"></div>
        <div class="virtual-window-resize-handle resize-se" data-direction="se"></div>
        <div class="virtual-window-resize-handle resize-sw" data-direction="sw"></div>
    </div>
</div>

<!-- ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åŠ è½½CSSå’ŒJS -->
{{ if not (.skipAssets) }}
{{ $needsAssets := true }}
{{ if (.Site.Data.virtualWindowLoaded) }}
    {{ $needsAssets = false }}
{{ end }}

{{ if $needsAssets }}
    {{ partial "virtual-window-assets.html" . }}
    {{ $.Site.SetData "virtualWindowLoaded" true }}
{{ end }}
{{ end }}